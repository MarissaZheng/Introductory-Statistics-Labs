---
title: "Pre-Lab 3: Hypothesis Tests"
output: learnr::tutorial
tutorial:
  id: "Pre-Lab 3"
  version: 1.0
runtime: shiny_prerendered
---

```{r setup, include=FALSE}

source("./packageHelpers.R")

require(ggplot2)
require(dplyr)
require(shiny)
require(learnr)
require(tidyr)
require(httpuv)

knitr::opts_chunk$set(echo = FALSE)


source("./makeStrings.R")

correct <- "<font color='red'>Correct!</font><br><br>"
incorrect <- "<font color='red'>Not quite right...</font><br><br>"
congrats <- "<font color='red'>You did it!</font><br><br>"

### %ni = new input (red), %oi = old input (blue)
```


```{r, echo = FALSE}

# Read Data
colleges = read.csv('http://calpoly.edu/~kbodwin/data/colleges1995.csv')
```

## College Data from 1995

In this PreLab, we will examine a dataset from US News and World Report pertaining to information about colleges.  Alas, this data is from 1995, so it is very outdated; still, we will see what we can learn from it.  The dataset is called `colleges`, and it has already been loaded for you.

Take a look at the dataset, and familiarize yourself with the variables.

```{r ex_1.1, exercise = TRUE}
```

## Public vs. Private Schools

We are interested in comparing several *quantitative* variables with the *categorical* variable about whether a school is public or private.

Let's start by exploring the data through plots, as in Lab 1.



```{r, echo=FALSE}
textInput("plot_var_5_2", 
          "What QUANTITATIVE variable would you like to plot?", 
          value = "", 
          width = '80%', 
          placeholder = NULL)

textInput("plot_var_5_3", 
          "What CATEGORICAL variable would you like to compare?", 
          value = "", 
          width = '80%', 
          placeholder = NULL)

bs_5_2 <- reactive("ggplot(%oi) + geom_%oi(aes(x = %ni, y = %ni, fill = %ni))")
# 
htmlOutput("code_5_2")
# 
plotOutput("plot_5_2")
```


```{r, context="server"}
output$plot_5_2 <- renderPlot({
 eval(parse(text = 
    makeEvalText(
      base_string = bs_5_2(), 
      old_input = c("colleges", "boxplot"),
      new_input = c(input$plot_var_5_3, input$plot_var_5_2, input$plot_var_5_3)
    )
   ))
})

output$code_5_2 <- renderText(
        makePrintText( 
      base_string = bs_5_2(), 
      old_input = c("colleges", "boxplot"),
      new_input = c(input$plot_var_5_3, input$plot_var_5_2, input$plot_var_5_3)
    )
  )

```

```{r, echo=FALSE}
textAreaInput("discuss_1", 
          "What do you think is true about Public and Private schools?", 
          value = "", 
          width = '80%', 
          placeholder = NULL)
```

## Checking for Normality

To do further analysis, it would be nice to know if our quantitative variables are **Normally** distributed.  We can check this by making histograms, and deciding if it is reasonable to assume the *true* density is a bell curve.

Use the code box below to check histograms of your variables.

```{r ex_1.2, exercise = TRUE}
```

Another way we check Normality is called a **Q-Q Plot**.  The idea behind a Q-Q plot is that if a variable is Normal, a sample should have the same "checkpoints", such as the median and the quartiles, as a sample that is truly Normal.  A Q-Q Plot puts the observed values of your variable, from largest to smallest, on the y-axis; and the theoretical values, that we would expect if the variable were Normal, on the x-axis.  If the points fall on a straight line, we can conclude that the variable is likely to be Normal.

Try it below!

```{r, echo=FALSE}
textInput("plot_var_5_1", 
          "What variable would you like to make a Q-Q plot for?", 
          value = "", 
          width = '80%', 
          placeholder = NULL)


bs_5_1 <- reactive("ggplot(%oi) + geom_%oi(aes(sample = %ni))")
# 
htmlOutput("code_5_1")
# 
plotOutput("plot_5_1")
```


```{r, context="server"}
output$plot_5_1 <- renderPlot({
 eval(parse(text = 
    makeEvalText(
      base_string = bs_5_1(), 
      old_input = c("colleges", "qq"),
      new_input = c(input$plot_var_5_1)
    )
   ))
})

output$code_5_1 <- renderText(
        makePrintText( 
          base_string = bs_5_1(), 
          old_input = c("colleges", "qq"),
         new_input = c(input$plot_var_5_1)
    )
  )

```


```{r letter-a, echo=FALSE}
question("Which variable do you think might be Normal?",
  answer("Type"),
  answer("Avg.SAT", correct = TRUE),
  answer("Size"),
  answer("Acceptance.Rate"),
  answer("Tuition")
)
```

## Hypothesis testing by hand

The plots we made tell us a little about Public and Private schools.  However, we would like to know if these observed differences are significant or not.

We don't know the true distribution of our variables.  Fortunately, we have `469` observations in this dataset, so we can calculate sample means and standard deviations.



```{r summarize}
textInput("var1",
          "Which variable would you like to find information about?",
          value = "",
          width = '80%', placeholder = NULL)

radioButtons("funs1", 
             "What information do you want?",
                   choices = c("Mean" = "mean",
                               "Standard Deviation" = "sd",
                               "Sample Size" = "length",
                               "All three" = "mean, sd, length")
              )

radioButtons("groups1", 
             "Do you want to calculate for Public and Private schools separately?",
                   choices = c("No" = "",
                               "Yes" = "%>% group_by(Type)")
              )


bs_1_1 = reactive("%oi %ni  %>% summarize_at(vars(%ni), funs(%ni))")

```

```{r, context="server"}

output$code_1_1 <- renderText(
        makePrintText(
          base_string = bs_1_1(),
          old_input = c("colleges"),
          new_input = c(input$groups1, input$var1, input$funs1)
        )
  )

output$output_1_1 <- renderPrint({
 eval(parse(text = 
    makeEvalText(
      base_string = bs_1_1(), 
          old_input = c("colleges"),
          new_input = c(input$groups1, input$var1, input$funs1)
    )
   ))
})

```

```{r}
htmlOutput("code_1_1")
```

Result:

```{r}
verbatimTextOutput("output_1_1")
```

Based on this output, calculate (using R or your calculator) the *test statistic* if we were to test whether Private colleges have higher average SAT scores than Public ones.  

*Hint: It may help to write out all your Hypothesis Test steps by hand.*

```{r q_3}
textInput("a_3.1",
           "The test statistic is: ",
           value = "0",
           width = '80%', placeholder = NULL)

htmlOutput("check_3.1")

```

```{r, context = "server"}

output$check_3.1 <- renderText(
  if(round(as.numeric(input$a_3.1),2) == -2.95){
      correct
  }else{
    incorrect
  }
)
```

In R, the functions `pt()` and `qt()` work the same way as `pnorm()` and `qnorm()`.  Try to edit the code below to find the p-value for the test statistic above.

```{r pt, exercise = TRUE}
pt(0, df = 1)
```


## Hypothesis testing with R

Luckily, we don't have to do t-tests by hand every time.  R can do this for us.

```{r t_tests}
textInput("quant",
          "What QUANTITATIVE variable do you want to test?",
          value = " ",
          width = '80%', placeholder = NULL)


textInput("cat",
          "What CATEGORICAL variable splits the groups?",
          value = " ",
          width = '80%', placeholder = NULL)

radioButtons("alt", 
             "What type of alternate hypothesis do you have?",
                   choices = c(">" = "greater",
                               "<" = "less",
                               "=/=" = "two.sided")
              )

bs_1_2 = reactive("t.test(%ni ~ %ni, data = %oi, ,alternative = '%ni')")

```

```{r, context="server"}

output$code_1_2 <- renderText(
        makePrintText(
          base_string = bs_1_2(),
          old_input = c("colleges"),
          new_input = c(input$quant, input$cat, input$alt)
        )
  )

output$output_1_2 <- renderPrint({
 eval(parse(text = 
    makeEvalText(
     base_string = bs_1_2(),
    old_input = c("colleges"),
    new_input = c(input$quant, input$cat, input$alt)
    )
   ))
})

```

```{r}
htmlOutput("code_1_2")
```

Result:

```{r}
verbatimTextOutput("output_1_2")
```


**Note:** R uses a complicated calculation for the *degrees of freedom* when two variables are involved.  Don't worry too much about this.

```{r q_4}
textInput("a_4",
           "What was the p-value for a test of whether Public and Private schools have the same acceptance rate?",
           value = "0",
           width = '80%', placeholder = NULL)

htmlOutput("check_4")

```

```{r, context = "server"}

output$check_4 <- renderText(
  if(round(as.numeric(input$a_4), 2) == 0.35){
      correct
  }else{
    incorrect
  }
)
```

## Looking ahead

**(optional section)**

Take a look at the following R code and output.  What do you think it does?  What would you conclude about colleges based on this?

```{r, echo = FALSE}
ca_types <- colleges %>% mutate(
        isCA = case_when(
          State == "CA" ~ "California",
          TRUE ~ "Other")
      ) %>%
  count(isCA, Type) %>%
  group_by(Type) %>%
  spread(isCA, n, fill = 0)

ca_types_matrix <- apply(ca_types[, -1], 1, as.numeric)
ca_types
```

```{r}

chisq.test(ca_types_matrix)

```
